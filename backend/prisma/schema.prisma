generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            Int        @id @default(autoincrement())
  name          String
  email         String     @unique
  password      String
  preferredLang String     @default("en") @map("preferred_lang")
  createdAt     DateTime   @default(now()) @map("created_at")
  projects      Project[]
  testCases     TestCase[]

  @@map("users")
}

model Project {
  id          Int       @id @default(autoincrement())
  name        String
  description String?
  language    String    @default("en") // en, ja, zh
  createdBy   User      @relation(fields: [createdById], references: [id])
  createdById Int       @map("created_by_id")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  versions    Version[]

  @@map("projects")
}

model Version {
  id          Int        @id @default(autoincrement())
  project     Project    @relation(fields: [projectId], references: [id], onDelete: Cascade)
  projectId   Int        @map("project_id")
  name        String
  description String?
  createdAt   DateTime   @default(now()) @map("created_at")
  updatedAt   DateTime   @updatedAt @map("updated_at")
  testCases   TestCase[]

  @@map("versions")
}

model TestCase {
  id          Int              @id @default(autoincrement())
  version     Version          @relation(fields: [versionId], references: [id], onDelete: Cascade)
  versionId   Int              @map("version_id")
  bug         String
  test        String
  result      String?
  status      String           @default("Open") // Open, Fixed, Verified
  isFixed     Boolean          @default(false) @map("is_fixed")
  isVerified  Boolean          @default(false) @map("is_verified")
  severity    String           @default("Low") // Critical, High, Medium, Low
  priority    String           @default("Low") // High, Medium, Low
  notes       String?
  createdBy   User             @relation(fields: [createdById], references: [id])
  createdById Int              @map("created_by_id")
  testedAt    DateTime?        @map("tested_at")
  createdAt   DateTime         @default(now()) @map("created_at")
  updatedAt   DateTime         @updatedAt @map("updated_at")
  images      TestCaseImage[]

  @@map("test_cases")
}

model TestCaseImage {
  id           Int      @id @default(autoincrement())
  testCase     TestCase @relation(fields: [testCaseId], references: [id], onDelete: Cascade)
  testCaseId   Int      @map("test_case_id")
  filePath     String   @map("file_path")
  originalName String   @map("original_name")
  uploadedAt   DateTime @default(now()) @map("uploaded_at")

  @@map("test_case_images")
}
